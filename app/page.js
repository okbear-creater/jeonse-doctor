'use client';

import React, { useState, useEffect, useCallback } from 'react';
import ReactMarkdown from 'react-markdown';
import Image from 'next/image';
import styles from './page.module.css';

const SendIcon = ({ className }) => (
  <svg
    className={className}
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    strokeWidth="2"
    strokeLinecap="round"
    strokeLinejoin="round"
  >
    <line x1="22" y1="2" x2="11" y2="13"></line>
    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
  </svg>
);

export default function Home() {
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState('');
  const [isGreetingShown, setIsGreetingShown] = useState(false);
  const [file, setFile] = useState(null);
  const [preview, setPreview] = useState(null);
  const [isLoading, setIsLoading] = useState(false);
  const [showExamples, setShowExamples] = useState(true);
  const [currentTypingMessage, setCurrentTypingMessage] = useState('');
  const [loadingDots, setLoadingDots] = useState('');
  const typingSpeed = 5;

  const examplePrompts = [
    "ë¶€ë™ì‚°ì´ ê²½ë§¤ì— ë„˜ì–´ê°€ë©´ ë³´ì¦ê¸ˆì„ ì–´ë–»ê²Œ ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?",
    "ê·¼ì €ë‹¹ì´ ì„¤ì •ëœ ì§‘ì—ì„œëŠ” ë³´ì¦ê¸ˆì„ ëŒë ¤ë°›ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
    "ì „ì…ì‹ ê³ ë¥¼ í•˜ë©´ ë³´ì¦ê¸ˆì— ì–´ë–¤ ë²•ì  ë³´í˜¸ë¥¼ ë°›ê²Œ ë˜ë‚˜ìš”?",
    "ìš°ì„  ë³€ì œê¶Œì´ë€ ë¬´ì—‡ì¸ê°€ìš”?",
    "ì „ì„¸ê¶Œ ì„¤ì •ì˜ íš¨ë ¥ì€ ì–¸ì œë¶€í„° ë°œìƒí•˜ë‚˜ìš”?",
    "ì „ì„¸ ë³´ì¦ ë³´í—˜ì€ ì–´ë–¤ ìƒí™©ì—ì„œ ë³´ì¦ê¸ˆì„ ë³´í˜¸í•´ì£¼ë‚˜ìš”?",
  ];

  const basicTopics = [
    "ì „ì„¸ê³„ì•½ì˜ ì ˆì°¨ì™€ ì£¼ì˜ì‚¬í•­ì€ ë¬´ì—‡ì¸ê°€ìš”?",
    "ì „ì„¸ì‚¬ê¸° ìœ í˜•ë³„ ì •ì˜ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
    "ì „ì„¸ì‚¬ê¸° ìœ í˜•ë³„ ì˜ˆë°©ë²•ì€ ë¬´ì—‡ì¸ê°€ìš”?",
  ];

  const predefinedAnswers = {
    "ì „ì„¸ê³„ì•½ì˜ ì ˆì°¨ì™€ ì£¼ì˜ì‚¬í•­ì€ ë¬´ì—‡ì¸ê°€ìš”?": `
1. ë¬¸ì˜ ë° ì§‘ êµ¬ê²½  
ë¶€ë™ì‚° ë¬¸ì˜ í›„ ì›í•˜ëŠ” ì§‘ì„ ì§ì ‘ ë°©ë¬¸í•˜ì—¬ ìœ ì‚¬ë§¤ë¬¼ê³¼ ë¹„êµ ë° ê²€í† í•©ë‹ˆë‹¤. ìœ„ì¹˜, ì§‘ êµ¬ì¡°, ì¡°ê±´ ë“±ì„ ê¼¼ê¼¼íˆ ì‚´í´ë³´ë©° ë§¤ë§¤ ì‹œì„¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

2. ë°© ì„ íƒ  
ì„ íƒí•œ ì§‘ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ê³ , ì§‘ì£¼ì¸ ë˜ëŠ” ë¶€ë™ì‚° ì¤‘ê°œì¸ê³¼ í˜‘ì˜í•˜ì—¬ ì„ëŒ€ ì¡°ê±´ì„ í™•ì •í•©ë‹ˆë‹¤. ì´ ë‹¨ê³„ì—ì„œ ì „ì…ì‹ ê³  ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

3. ê°€ê³„ì•½  
ê±°ì£¼ì¸ì›, í¡ì—° ì—¬ë¶€ë“±ì„ ì‚¬ì „ ê³ ì§€í•˜ê³ , ê³„ì•½ê¸ˆ ì¼ë¶€ë¥¼ ì†¡ê¸ˆí•˜ì—¬ ê°€ê³„ì•½ì„ ì²´ê²°í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ì„ ìˆœìœ„ ê¶Œë¦¬, ì„ëŒ€ì¸ ì‹ ë¶„ì¦ í™•ì¸, ë³¸ê³„ì•½ì¼, ì”ê¸ˆì¼ ìƒíƒœ í™•ì¸ ë“±ì´ í•„ìš”í•©ë‹ˆë‹¤.

4. ë³¸ê³„ì•½  
ê°€ê³„ì•½ì—ì„œ í™•ì¸í•œ ëª¨ë“  ì‚¬í•­ì„ ë‹¤ì‹œ í•œ ë²ˆ ì ê²€í•˜ê³ , ê³„ì•½ì„œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. ì„¸ë¶€ íŠ¹ì•½ì‚¬í•­ë“±ì˜ ì¡°ê±´ì„ í˜‘ì˜í•˜ê³ , ì”ì—¬ ê³„ì•½ê¸ˆ ì§€ê¸‰ ë° ê³„ì•½ê¸ˆ ì˜ìˆ˜ì¦ì„ ì¶œë ¥í•©ë‹ˆë‹¤.

5. ì”ê¸ˆ  
ì”ê¸ˆ ì „ ì „ì„¸ëŒ€ì¶œ ê°€ëŠ¥ ì—¬ë¶€/ì€í–‰ì— ëŒ€ì¶œ ì‹¤í–‰ ì‹œê°„ / ì„ ìˆœìœ„ê¶Œë¦¬ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ì”ê¸ˆ ì†¡ê¸ˆ ë° ì¤‘ê°œìˆ˜ìˆ˜ë£Œë¥¼ ë‚©ì…í•˜ê³ , ë¹„í’ˆ ìˆ˜ë ¹ ë° ê´€ë¦¬ë¹„, ê°€ìŠ¤ì •ì‚°ì„ ì‹¤ì‹œí•©ë‹ˆë‹¤. ì”ê¸ˆ ì§€ê¸‰ì´ ì™„ë£Œë˜ë©´ ì „ì…ì‹ ê³ ë¥¼ í•  ìˆ˜ ìˆìœ¼ë©°, ë¶€ë™ì‚° ê±°ë˜ ì‹ ê³ ë¥¼ ë§ˆë¬´ë¦¬í•©ë‹ˆë‹¤.

6. ì…ì£¼  
ì „ì…ì‹ ê³ ì™€ í•¨ê»˜ ì…ì£¼ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. (ì´ë•Œ, í™•ì •ì¼ìë¥¼ ë°›ì•„ë‘ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.) ë¶€ë™ì‚° ê±°ë˜ ì‹ ê³ ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.

í•´ë‹¹ ê°€ì´ë“œë¼ì¸ì„ ì°¸ê³ í•˜ì—¬ ì „ì„¸ê³„ì•½ ì ˆì°¨ë¥¼ ì•ˆì „í•˜ê²Œ ì§„í–‰í•  ìˆ˜ ìˆë„ë¡ ì¤€ë¹„í•˜ì„¸ìš”. ë¬´ì—‡ë³´ë‹¤ ê³„ì•½ì„œ ì‘ì„± ì‹œ ëª¨ë“  ì¡°ê±´ì„ ëª…í™•íˆ ì´í•´í•˜ê³ , ë§¤ë¬¼ì˜ ê¶Œë¦¬ ìƒíƒœì™€ ì„ëŒ€ì¸ì˜ ì‹ ë¶„ì„ ì² ì €íˆ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
`,
    "ì „ì„¸ì‚¬ê¸° ìœ í˜•ë³„ ì •ì˜ëŠ” ë¬´ì—‡ì¸ê°€ìš”?": `
1. ê¹¡í†µì „ì„¸  
   - ì •ì˜: ì‹¤ì œ ì‹œì„¸ë³´ë‹¤ ë†’ì€ ê°€ê²©ìœ¼ë¡œ ì‹œì„¸ë¥¼ ê¸°ì¬í•˜ê³ , ì´ì— ë§ì¶”ì–´ ë³´ì¦ê¸ˆì„ ìš”êµ¬í•˜ëŠ” ì „ì„¸ì‚¬ê¸° ìœ í˜•ì…ë‹ˆë‹¤. ë¶€ë™ì‚° ì‹œì„¸ê°€ í•˜ë½í•  ê²½ìš°, ë³´ì¦ê¸ˆì„ ëŒë ¤ë°›ì§€ ëª»í•˜ê²Œ ë˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ì´ëŠ” ë³´ì¦ê¸ˆì„ í™œìš©í•´ ë‹¤ë¥¸ ë¶€ë™ì‚°ì„ ë§¤ìˆ˜í•˜ê³ , ë‹¤ì‹œ ì „ì„¸ë¥¼ ì„¤ì •í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰ë˜ë©°, ê²°êµ­ ì„¸ì…ìëŠ” ë³´ì¦ê¸ˆì„ íšŒìˆ˜í•˜ì§€ ëª»í•  ìœ„í—˜ì— ì²˜í•©ë‹ˆë‹¤.

2. ì´ì¤‘ ê³„ì•½ / ì¤‘ë³µ ê³„ì•½  
   - ì •ì˜:  
     - ì´ì¤‘ ê³„ì•½: ì§‘ì£¼ì¸ì´ ëŒ€ë¦¬ì¸ì—ê²Œ ì›”ì„¸ ê³„ì•½ì„ ìœ„ì„í•˜ì˜€ìœ¼ë‚˜, ëŒ€ë¦¬ì¸ì´ ì´ë¥¼ ì•…ìš©í•˜ì—¬ ì›”ì„¸ ê³„ì•½ ëŒ€ì‹  ì „ì„¸ ê³„ì•½ì„ ì²´ê²°í•˜ê³  ê¸ˆì•¡ì„ ì°©ë³µí•˜ëŠ” ìœ í˜•ì…ë‹ˆë‹¤. ëŒ€ë¦¬ì¸ì€ ê´€ë¦¬ ê³„ì•½ì„ ë§ºê³  ìˆìœ¼ë¯€ë¡œ ì§‘ì£¼ì¸ì˜ ë™ì˜ ì—†ì´ë„ ì„ëŒ€ì°¨ ê³„ì•½ì„ ì²´ê²°í•  ìˆ˜ ìˆìœ¼ë©°, ì´í›„ ëˆì„ ì±™ê¸°ê³  ì ì í•˜ëŠ” ê²½ìš°ê°€ ë°œìƒí•©ë‹ˆë‹¤.
     - ì¤‘ë³µ ê³„ì•½: ë™ì¼í•œ ë¶€ë™ì‚°ì„ ì—¬ëŸ¬ ì„¸ì…ìì™€ ì¤‘ë³µìœ¼ë¡œ ê³„ì•½ì„ ì²´ê²°í•˜ëŠ” ì‚¬ê¸° ìœ í˜•ìœ¼ë¡œ, ê° ì„¸ì…ìëŠ” ìì‹ ì´ ìœ ì¼í•œ ê³„ì•½ìë¼ê³  ë¯¿ê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì‹¤ì œë¡œëŠ” ë³µìˆ˜ì˜ ì„¸ì…ìë“¤ì´ ë™ì¼í•œ ë¶€ë™ì‚°ì— ëŒ€í•œ ê¶Œë¦¬ë¥¼ ì£¼ì¥í•˜ê²Œ ë˜ì–´ í”¼í•´ê°€ ë°œìƒí•©ë‹ˆë‹¤.

3. ë¶ˆë²• ê±´ì¶•ë¬¼ ì‚¬ê¸°  
   - ì •ì˜: ì£¼ê±°ìš©ìœ¼ë¡œ í—ˆê°€ë°›ì§€ ì•Šì€ ê±´ì¶•ë¬¼ì„ ì „ì„¸ ì£¼íƒìœ¼ë¡œ ì†ì—¬ ê³„ì•½í•˜ëŠ” ì‚¬ê¸° ìœ í˜•ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ê³ ì‹œì› ê°™ì€ ê·¼ë¦°ìƒí™œì‹œì„¤ ë“±ì„ ì›ë£¸ì´ë¼ ì†ì—¬ ê³„ì•½ ì‹œ, ìš©ë„ ë³€ê²½ ì‚¬ì‹¤ì´ ë°œê°ë˜ë©´ ì„¸ì…ìëŠ” í‡´ê±° ëª…ë ¹ì´ë‚˜ ì² ê±°ì— ì§ë©´í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ ê²½ìš° ì „ì„¸ ì‚¬ê¸° í”¼í•´ìë¡œë„ ì¸ì •ë°›ê¸° ì–´ë ¤ì›Œì§€ë©° ë³´ì¦ê¸ˆì„ ëŒë ¤ë°›ì§€ ëª»í•  ê°€ëŠ¥ì„±ì´ ì»¤ì§‘ë‹ˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” ì •ë¶€24ì—ì„œ ê±´ì¶•ë¬¼ ëŒ€ì¥ì„ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

4. ê°­íˆ¬ì ì‚¬ê¸°  
   - ì •ì˜: ì „ì„¸ ì„¸ì…ìë¥¼ ë¨¼ì € êµ¬í•˜ê³  ë°›ì€ ì „ì„¸ ë³´ì¦ê¸ˆì„ ê¸°ë°˜ìœ¼ë¡œ ë¶€ë™ì‚°ì„ ë§¤ì…í•œ í›„, ê°€ê²© ìƒìŠ¹ì„ ê¸°ëŒ€í•˜ëŠ” íˆ¬ì ë°©ì‹ì…ë‹ˆë‹¤. ë§Œì•½ ë¶€ë™ì‚° ê°€ê²©ì´ í•˜ë½í•  ê²½ìš°, ì§‘ì£¼ì¸ì€ ì„¸ì…ìì—ê²Œ ë³´ì¦ê¸ˆì„ ëŒë ¤ì¤„ ìˆ˜ ì—†ìœ¼ë©°, ë¶€ë™ì‚°ì´ ê²½ë§¤ë¡œ ë„˜ì–´ê°€ê²Œ ë©ë‹ˆë‹¤. ê²½ë§¤ ë‚™ì°°ê°€ê°€ ë–¨ì–´ì§€ë©´ ê·¼ì €ë‹¹ì´ ì„¸ì…ìë³´ë‹¤ ìš°ì„ í•˜ê²Œ ë˜ì–´ ì„¸ì…ìëŠ” ì†í•´ë¥¼ ë³´ê²Œ ë©ë‹ˆë‹¤.

5. ì‹ íƒ ì‚¬ê¸°  
   - ì •ì˜: ê±´ë¬¼ì£¼ê°€ ê±´ì¶• ìê¸ˆì„ ë§ˆë ¨í•˜ê¸° ìœ„í•´ ì‹ íƒíšŒì‚¬ì— ì†Œìœ ê¶Œì„ ë„˜ê¸°ê³ , ì´ë¥¼ í†µí•´ ì€í–‰ì—ì„œ ëŒ€ì¶œì„ ë°›ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì‹ íƒì›ë¶€ì— ë”°ë¥´ë©´, ê±´ë¬¼ì£¼ëŠ” ì‹ íƒíšŒì‚¬ì˜ ë™ì˜ ì—†ì´ëŠ” ì„ëŒ€ë‚˜ ë§¤ë§¤ë¥¼ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê±´ë¬¼ì£¼ê°€ ì‹ íƒíšŒì‚¬ì˜ ë™ì˜ ì—†ì´ ì„¸ì…ìì™€ ì„ëŒ€ ê³„ì•½ì„ ì²´ê²°í•˜ê³  ë³´ì¦ê¸ˆì„ ìˆ˜ë ¹í•œ ë’¤ ì ì í•˜ëŠ” ì‚¬ê¸° ìœ í˜•ì…ë‹ˆë‹¤. ì´ ê²½ìš°, ì„¸ì…ìëŠ” ì„ëŒ€ì°¨ë³´í˜¸ë²•ì˜ ë³´í˜¸ë¥¼ ë°›ì§€ ëª»í•˜ê²Œ ë©ë‹ˆë‹¤.

6. ëŒ€í•­ë ¥íš¨ë ¥ë°œìƒì‹œì  ì•…ìš© ì‚¬ê¸°  
   - ì •ì˜: ì „ì…ì‹ ê³  í›„ ëŒ€í•­ë ¥ê³¼ ìš°ì„ ë³€ì œê¶Œì´ ë°œìƒí•˜ê¸° ì „ì˜ ì‹œì ì„ ì•…ìš©í•œ ì‚¬ê¸° ìœ í˜•ì…ë‹ˆë‹¤. ì„¸ì…ìê°€ ì „ì…ì‹ ê³ ë¥¼ ë§ˆì¹˜ê³  í™•ì •ì¼ìë¥¼ ë°›ê¸° ì „ê¹Œì§€ëŠ” ë¬´ë°©ë¹„ ìƒíƒœì— ë†“ì´ê²Œ ë˜ëŠ”ë°, ì§‘ì£¼ì¸ì€ ì´ í‹ˆì„ ì´ìš©í•´ ê³„ì•½ ë‹¹ì¼ ëŒ€ì¶œì„ ë°›ì•„ ê·¼ì €ë‹¹ì„ ì„¤ì •í•˜ê³  ì ì í•©ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ì„¸ì…ìëŠ” ì€í–‰ë³´ë‹¤ í›„ìˆœìœ„ë¡œ ë°€ë ¤ ë³´ì¦ê¸ˆì„ íšŒìˆ˜í•˜ì§€ ëª»í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ê³„ì•½ í›„ ì”ê¸ˆ ì§€ê¸‰ ë‹¤ìŒë‚ ê¹Œì§€ ê·¼ì €ë‹¹ ì„¤ì • ê¸ˆì§€ë¥¼ ëª…ì‹œí•˜ê±°ë‚˜, ì „ì„¸ê¶Œì„ ì„¤ì •í•˜ëŠ” ê²ƒì´ í•„ìš”í•©ë‹ˆë‹¤.
`,
    "ì „ì„¸ì‚¬ê¸° ìœ í˜•ë³„ ì˜ˆë°©ë²•ì€ ë¬´ì—‡ì¸ê°€ìš”?": `
**1. ê¹¡í†µì „ì„¸**  
ì˜ˆë°©ë²•: í‰ê·  ì „ì„¸ê°€ìœ¨ì„ í™•ì¸í•˜ì—¬ ì „ì„¸ê°€ê°€ ì ì •í•œì§€ ê²€í† í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì§€ë‚˜ì¹˜ê²Œ ë†’ì€ ì „ì„¸ê°€ìœ¨ë¡œ ì¸í•œ ìœ„í—˜ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**2. ì´ì¤‘ê³„ì•½**  
ì˜ˆë°©ë²•: ì„ëŒ€ì°¨ ê³„ì•½ì„ ë°˜ë“œì‹œ ì§‘ì£¼ì¸ê³¼ ì§ì ‘ ì²´ê²°í•˜ê³ , ë“±ê¸°ë¶€ë“±ë³¸ì„ ì—´ëŒí•˜ì—¬ ì†Œìœ ì£¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì´ì¤‘ê³„ì•½ìœ¼ë¡œ ì¸í•œ í”¼í•´ë¥¼ ì˜ˆë°©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**3. ë¶ˆë²• ê±´ì¶•ë¬¼ ì‚¬ê¸°**  
ì˜ˆë°©ë²•: ì •ë¶€24 ì‚¬ì´íŠ¸ì—ì„œ ê±´ì¶•ë¬¼ ëŒ€ì¥ì„ í™•ì¸í•˜ì—¬ ê±´ì¶•ë¬¼ì˜ í•©ë²•ì„±ì„ ê²€í† í•©ë‹ˆë‹¤. ë¶ˆë²• ê±´ì¶•ë¬¼ ì—¬ë¶€ë¥¼ í™•ì¸í•¨ìœ¼ë¡œì¨ ì•ˆì „í•œ ê³„ì•½ì„ ì²´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**4. ê°­íˆ¬ì ì‚¬ê¸°**  
ì˜ˆë°©ë²•: ì „ì„¸ë³´ì¦ê¸ˆ ë°˜í™˜ë³´ì¦ì„ ê°€ì…í•˜ê³  ì „ì„¸ê¶Œ ì„¤ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤. ë˜í•œ, ë¶€ë™ì‚° ì‹œì„¸ì˜ 75%ì—ì„œ ê·¼ì €ë‹¹ì•¡ê³¼ ì „ì„¸ê¸ˆì„ ëº€ ê°’ì´ 0 ì´ìƒì¸ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

**5. ì‹ íƒì‚¬ê¸°**  
ì˜ˆë°©ë²•: ë“±ê¸°ë¶€ë“±ë³¸ì˜ ê°‘êµ¬ì— ì‹ íƒ ë“±ê¸°ê°€ ê¸°ì¬ë˜ì–´ ìˆë‹¤ë©´, ë“±ê¸°ì†Œì— ë°©ë¬¸í•˜ì—¬ ì‹ íƒì›ë¶€ë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ í›„ ëŒ€ê¸ˆì§€ê¸‰ìì˜ í™•ì¸ê³¼ ë™ì˜ë¥¼ ë°›ì•˜ë‹¤ë©´ ê±°ë˜ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.

**6. ëŒ€í•­ë ¥ íš¨ë ¥ ë°œìƒ ì‹œì  ì•…ìš© ì‚¬ê¸°**  
ì˜ˆë°©ë²•: ê³„ì•½ í›„ ì „ì…ì‹ ê³  ì ˆì°¨ë¥¼ ì§„í–‰í•˜ëŠ” ë™ì•ˆ, ëŒ€í•­ë ¥ì´ ë°œìƒí•˜ëŠ” ì‹œì  ì´ì „ì— ê·¼ì €ë‹¹ ì„¤ì •ì´ ì´ë£¨ì–´ì§€ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤. ì „ì„¸ê³„ì•½ì„œì— â€œëŒ€í•­ë ¥ ë°œìƒì‹œì ë³´ë‹¤ ì´ë¥¸ ì‹œì ì— ê¶Œë¦¬ ì‚¬í•­ì´ ì¶”ê°€ë  ê²½ìš° í•´ë‹¹ ê³„ì•½ì„ ë¬´íš¨ë¡œ í•œë‹¤â€ëŠ” ì¡°ê±´ì„ ì¶”ê°€í•˜ì—¬ ë³´í˜¸ë°›ì„ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
`,
    "ë¶€ë™ì‚°ì´ ê²½ë§¤ì— ë„˜ì–´ê°€ë©´ ë³´ì¦ê¸ˆì„ ì–´ë–»ê²Œ ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?": `
ë§Œì•½ ì§‘ì£¼ì¸ì´ íŒŒì‚° ë“± ëª¨ì¢…ì˜ ì´ìœ ë¡œ ì „ì„¸ ë³´ì¦ê¸ˆì„ ëŒë ¤ì£¼ì§€ ëª»í•˜ê²Œ ë˜ë©´, í•´ë‹¹ ë¶€ë™ì‚°ì€ ê²½ë§¤ì— ë„˜ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²½ë§¤ì— ë„˜ì–´ê°„ ë¶€ë™ì‚°ì´ ì œ3ìì—ê²Œ ë‚™ì°°ëœë‹¤ë©´, í•´ë‹¹ ë¶€ë™ì‚°ì„ êµ¬ë§¤í•œ ì œ3ìì—ê²Œ ë³´ì¦ê¸ˆì„ ëŒë ¤ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê²½ë§¤ì— ë„˜ì–´ê°„ ë¶€ë™ì‚°ì´ ì œ3ìì—ê²Œ ë‚™ì°°ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´, ê²½ë§¤ëŠ” ìœ ì°°ë©ë‹ˆë‹¤. ê²½ë§¤ê°€ í•œ ë²ˆ ìœ ì°°ë  ë•Œë§ˆë‹¤ ìµœì € ì…ì°°ê°€ëŠ” 20~30% ì •ë„ í•˜ë½í•˜ê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ, ì „ì„¸ ê³„ì•½ì„ ë§ºì„ ë•ŒëŠ” (ë§¤ë§¤ê°€) x 70% > (ì „ì„¸ë³´ì¦ê¸ˆ)ì¸ ì§‘ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.
`,
    "ê·¼ì €ë‹¹ì´ ì„¤ì •ëœ ì§‘ì—ì„œëŠ” ë³´ì¦ê¸ˆì„ ëŒë ¤ë°›ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?": `
ì§‘ì£¼ì¸ì´ ë¶€ë™ì‚°ì„ ë§¤ì…í•  ë‹¹ì‹œ, ë˜ëŠ” ê·¸ë³´ë‹¤ ì´ì „ ì‹œì ì— ì€í–‰ìœ¼ë¡œë¶€í„° ëŒ€ì¶œì„ ë°›ê²Œ ë˜ë©´, í•´ë‹¹ ë¶€ë™ì‚°ì— ëŒ€í•´ ê·¼ì €ë‹¹ì´ ì„¤ì •ë©ë‹ˆë‹¤. ì´ëŠ” ì€í–‰ì´ ëŒ€ì¶œê¸ˆì„ ë‹´ë³´í•˜ê¸° ìœ„í•´ ë¶€ë™ì‚°ì— ê¶Œë¦¬ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒìœ¼ë¡œ, ê·¼ì €ë‹¹ ì„¤ì •ì˜ ì‹œì ì´ ì„ì°¨ì¸ê³¼ì˜ ê³„ì•½ ì²´ê²°ë³´ë‹¤ ì•ì„œê²Œ ë˜ë©´, ì„ì°¨ì¸ì˜ ë³€ì œê¶Œë³´ë‹¤ ì€í–‰ì˜ ê¶Œë¦¬ê°€ ìš°ì„ ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ, ê·¼ì €ë‹¹ì´ ì„¤ì •ëœ ê²½ìš° ì„ì°¨ì¸ì€ ë³´ì¦ê¸ˆì„ ì˜¨ì „íˆ ëŒë ¤ë°›ì§€ ëª»í•  ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë¦¬ìŠ¤í¬ë¥¼ ì¤„ì´ê¸° ìœ„í•´, ê·¼ì €ë‹¹ì´ ìˆëŠ” ë§¤ë¬¼ì˜ ì „ì„¸ ê³„ì•½ì„ ì²´ê²°í•  ì‹œ ë§¤ë§¤ê°€ x 70% > (ì „ì„¸ë³´ì¦ê¸ˆ) + (ê·¼ì €ë‹¹ì•¡)ì˜ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì§‘ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.
`,
    "ì „ì…ì‹ ê³ ë¥¼ í•˜ë©´ ë³´ì¦ê¸ˆì— ì–´ë–¤ ë²•ì  ë³´í˜¸ë¥¼ ë°›ê²Œ ë˜ë‚˜ìš”?": `
â€˜ì „ì…ì‹ ê³ â€™ëŠ” ì£¼ì†Œë¥¼ ë³€ê²½í•œ ê²½ìš°, í•´ë‹¹ í–‰ì • êµ¬ì—­ì˜ ê´€ë¦¬ìì—ê²Œ ë³¸ì¸ì˜ ì£¼ì†Œ ë³€ê²½ ì‚¬ì‹¤ì„ ì•Œë¦¬ëŠ” í–‰ìœ„ì…ë‹ˆë‹¤. ì „ì…ì‹ ê³  ì‹œ, â€˜í™•ì •ì¼ìâ€™ì™€ â€˜ëŒ€í•­ë ¥â€™ì´ ë°œìƒí•©ë‹ˆë‹¤.

â€˜í™•ì •ì¼ìâ€™ëŠ” í•´ë‹¹ ì£¼ì†Œì— ì–¸ì œë¶€í„° ê±°ì£¼í–ˆëŠ”ì§€ë¥¼ ê³µì‹ì ìœ¼ë¡œ ë“±ë¡í•˜ì—¬ ëª…ì‹œí•˜ëŠ” ì ˆì°¨ì…ë‹ˆë‹¤. ëŒ€í•­ë ¥ì€ ì£¼íƒì„ ì‚¬ìš©í•  ê¶Œë¦¬ì™€ ë³´ì¦ê¸ˆì„ ëŒë ¤ë°›ì„ ê¶Œë¦¬ì´ë©°, ì „ì…ì‹ ê³  ë‹¤ìŒ ë‚  0ì‹œë¶€í„° ë°œìƒí•©ë‹ˆë‹¤. ì „ì…ì‹ ê³ ë¥¼ í†µí•´ ëŒ€í•­ë ¥ì„ ê°–ì¶°ì•¼ë§Œ ì „ì„¸ ë³´ì¦ê¸ˆì— ëŒ€í•´ ë²•ì  ë³´í˜¸ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
`,
    "ìš°ì„  ë³€ì œê¶Œì´ë€ ë¬´ì—‡ì¸ê°€ìš”?": `
ìš°ì„  ë³€ì œê¶Œì´ë€ ë¶€ë™ì‚°ì´ ê²½ë§¤ì—ì„œ ë‚™ì°°ë  ë•Œ ì„ì°¨ì¸ì˜ ê¶Œë¦¬ê°€ ìš°ì„ ì ìœ¼ë¡œ ë³´í˜¸ë˜ëŠ” ê¶Œë¦¬ì…ë‹ˆë‹¤. ì´ ê¶Œë¦¬ëŠ” ì„ì°¨ì¸ì´ ì „ì…ì‹ ê³ ë¥¼ í•˜ê³  ëŒ€í•­ë ¥ ì·¨ë“ê³¼ í•¨ê»˜ í™•ì •ì¼ìë¥¼ ë°›ì•„ì•¼ ë°œìƒí•©ë‹ˆë‹¤. ë‹¨, í™•ì •ì¼ìê°€ ê·¼ì €ë‹¹ ì„¤ì •ë³´ë‹¤ ì•ì„  ê²½ìš°ì—ë§Œ ìš°ì„  ë³€ì œê¶Œì´ ì ìš©ë©ë‹ˆë‹¤.
`,
    "ì „ì„¸ê¶Œ ì„¤ì •ì˜ íš¨ë ¥ì€ ì–¸ì œë¶€í„° ë°œìƒí•˜ë‚˜ìš”?": `
ì „ì„¸ê¶Œ ì„¤ì •ì˜ íš¨ë ¥ì€ ì „ì„¸ ê³„ì•½ì´ ì²´ê²°ëœ ì¦‰ì‹œ ë°œìƒí•©ë‹ˆë‹¤. ì´ëŠ” í™•ì •ì¼ìë‚˜ ìš°ì„ ë³€ì œê¶Œê³¼ ìœ ì‚¬í•œ ê¶Œë¦¬ì´ì§€ë§Œ, ìµì¼ 0ì‹œì— íš¨ë ¥ì´ ë°œíœ˜ë˜ëŠ” ê²ƒê³¼ ë‹¬ë¦¬, ì „ì„¸ ê³„ì•½ê³¼ ë™ì‹œì— íš¨ë ¥ì´ ë°œíœ˜ëœë‹¤ëŠ” ì ì—ì„œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.
`,
    "ì „ì„¸ ë³´ì¦ ë³´í—˜ì€ ì–´ë–¤ ìƒí™©ì—ì„œ ë³´ì¦ê¸ˆì„ ë³´í˜¸í•´ì£¼ë‚˜ìš”?": `
ì „ì„¸ ë³´ì¦ ë³´í—˜ì€ ë³´í—˜ë£Œë¥¼ ë‚©ë¶€í•œ ì„¸ì…ìê°€ ê±°ì£¼í•˜ëŠ” ë¶€ë™ì‚°ì´ ê²½ë§¤ì— ë„˜ì–´ê°”ì„ ë•Œ, í•´ë‹¹ ë³´í—˜ ê¸°ê´€ì´ ë³´ì¥í•œë„ ë‚´ì—ì„œ ì „ì„¸ë³´ì¦ê¸ˆì„ ì„ ì§€ê¸‰í•´ì£¼ëŠ” ì œë„ì…ë‹ˆë‹¤. ë‹¤ë§Œ, ê·¼ì €ë‹¹ì´ë‚˜ ì‹ íƒ ë“± ê¶Œë¦¬ê´€ê³„ê°€ ë³µì¡í•œ ê²½ìš°ì—ëŠ” ë¦¬ìŠ¤í¬ê°€ ë†’ì•„ì ¸ ë³´í—˜ ê°€ì…ì´ ê±°ì ˆë  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.
`,
  };

  useEffect(() => {
    if (!isGreetingShown) {
      const initialMessage = "ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ì „ì„¸ë‹¥í„°AIì…ë‹ˆë‹¤. ì „ì„¸ ê³„ì•½ì´ ê±±ì •ë˜ì‹œë‚˜ìš”? ì „ì„¸ ì‚¬ê¸° ì˜ˆë°©ë¶€í„° ë‹¤ì–‘í•œ ë„ì›€ì„ ë“œë¦´ ìˆ˜ ìˆì–´ìš”. ì „ì„¸ì™€ ê´€ë ¨í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ í¸í•˜ê²Œ ë¬¼ì–´ë³´ì„¸ìš”!";
      setCurrentTypingMessage(initialMessage);
      setIsGreetingShown(true);
    }
  }, [isGreetingShown]);

  useEffect(() => {
    if (currentTypingMessage) {
      let index = 0;
      const timer = setInterval(() => {
        if (index < currentTypingMessage.length) {
          setMessages(prev => {
            const newMessages = [...prev];
            if (newMessages.length > 0 && newMessages[newMessages.length - 1].role === 'assistant') {
              newMessages[newMessages.length - 1].content = currentTypingMessage.slice(0, index + 1);
            } else {
              newMessages.push({ role: 'assistant', content: currentTypingMessage.slice(0, index + 1) });
            }
            return newMessages;
          });
          index++;
        } else {
          clearInterval(timer);
          setCurrentTypingMessage('');
          setIsLoading(false);
        }
      }, typingSpeed);

      return () => clearInterval(timer);
    }
  }, [currentTypingMessage]);

  useEffect(() => {
    if (isLoading) {
      const loadingTimer = setInterval(() => {
        setLoadingDots(prev => (prev.length < 3 ? prev + '.' : ''));
      }, 500);

      return () => clearInterval(loadingTimer);
    } else {
      setLoadingDots('');
    }
  }, [isLoading]);

  const handleFileChange = useCallback((event) => {
    const selectedFile = event.target.files[0];
    if (selectedFile) {
      setFile(selectedFile);
      const reader = new FileReader();
      reader.onloadend = () => {
        setPreview(reader.result);
      };
      reader.readAsDataURL(selectedFile);
    }
  }, []);

  const handleSendMessage = async (message) => {
    if (message.trim() === '') return;

    setMessages((prev) => [...prev, { role: 'user', content: message }]);
    setInput('');
    setIsLoading(true);
    setShowExamples(false);
    setMessages((prev) => [...prev, { role: 'assistant', content: '' }]);

    try {
      const responseMessage = predefinedAnswers[message];
      if (responseMessage) {
        setCurrentTypingMessage(responseMessage);
      } else {
        const formData = new FormData();
        formData.append('message', message);
        if (file) {
          formData.append('file', file);
        }

        const res = await fetch('/api/chat', {
          method: 'POST',
          body: formData,
        });

        const data = await res.json();
        if (data.response) {
          setCurrentTypingMessage(data.response);
        } else {
          setCurrentTypingMessage('ì£„ì†¡í•©ë‹ˆë‹¤, ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
        }
      }
    } catch (error) {
      console.error('Error:', error);
      setCurrentTypingMessage('ì£„ì†¡í•©ë‹ˆë‹¤, ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
    } finally {
      setFile(null);
      setPreview(null);
    }
  };

  const handleTopicClick = (title) => {
    handleSendMessage(title);
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter') {
      handleSendMessage(input);
    }
  };

  return (
    <div className={styles.pageContainer}>
      <header className={styles.header}>
        <h1 className={styles.title}>ì±—ë´‡</h1>
      </header>
      <div className={styles.chatContainer}>
        <div className={styles.chatMessages}>
          {messages.map((message, index) => (
            <div key={index} className={`${styles.message} ${message.role === 'user' ? styles.userMessage : styles.assistantMessage}`}>
              {message.role === 'assistant' && <span className={styles.assistantEmoji}>ğŸ¤–</span>}
              <div className={styles.messageContent}>
                {message.role === 'user' ? (
                  message.content
                ) : (
                  <ReactMarkdown
                    components={{
                      p: ({ children }) => <p className={styles.paragraph}>{children}</p>
                    }}
                  >
                    {message.content || loadingDots}
                  </ReactMarkdown>
                )}
              </div>
            </div>
          ))}
          {messages.some(msg => msg.content.includes(predefinedAnswers["ì „ì„¸ê³„ì•½ì˜ ì ˆì°¨ì™€ ì£¼ì˜ì‚¬í•­ì€ ë¬´ì—‡ì¸ê°€ìš”?"])) && (
            <div className={styles.imageContainer}>
              <Image src="/pictogram.png" alt="Pictogram ì´ë¯¸ì§€" width={750} height={241} />
            </div>
          )}
        </div>
      </div>
      <div className={styles.inputWrapper}>
        {showExamples && (
          <>
            <h2 className={styles.sectionTitle}>ê¸°ë³¸ì‚¬í•­</h2>
            <div className={styles.examplePromptsWrapper}>
              <div className={styles.examplePrompts}>
                {basicTopics.map((title, index) => (
                  <button key={index} onClick={() => handleTopicClick(title)} className={styles.examplePrompt}>
                    {title}
                  </button>
                ))}
              </div>
            </div>
            <h2 className={styles.sectionTitle}>ë§ì´ ë¬»ëŠ” ì§ˆë¬¸</h2>
            <div className={styles.examplePromptsWrapper}>
              <div className={styles.examplePrompts}>
                {examplePrompts.map((prompt, index) => (
                  <button key={index} onClick={() => handleSendMessage(prompt)} className={styles.examplePrompt}>
                    {prompt}
                  </button>
                ))}
              </div>
            </div>
          </>
        )}
        <div className={styles.inputContainer}>
          <div className={styles.inputWrapperPill}>
            <input
              type="text"
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyPress={handleKeyPress}
              placeholder="ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?"
              className={styles.inputInsidePill}
            />
            <button
              onClick={() => handleSendMessage(input)}
              className={styles.sendButtonInsidePill}
              disabled={isLoading}
              aria-label="ë©”ì‹œì§€ ì „ì†¡"
            >
              <SendIcon className={styles.sendIconInsidePill} />
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
